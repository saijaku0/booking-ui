<div
  class="dashboard-container"
  (click)="closeAllMenus()"
  (keydown.escape)="closeAllMenus()"
  tabindex="-1"
>
  <div class="page-header">
    <div class="header-titles">
      <h2>Dashboard</h2>
      <p class="subtitle">Welcome back, Dr. {{ doctorFullName() }}</p>
    </div>
  </div>

  <app-stats-cards [stats]="stats"></app-stats-cards>

  <div class="section-container">
    <div class="section-header">
      <div class="header-left">
        <h3>Upcoming Appointments</h3>
        <span class="count-badge">{{ filteredAppointments().length }}</span>
      </div>

      <div class="table-controls">
        <div
          class="search-box"
          (click)="$event.stopPropagation()"
          (keydown)="$event.stopPropagation()"
          tabindex="-1"
        >
          <span class="material-icons">search</span>
          <input
            type="text"
            placeholder="Search patient..."
            [value]="searchQuery()"
            (input)="onSearch($event)"
          />
        </div>

        <div class="filter-tabs">
          @for (filter of filterOptions(); track filter) {
            <button
              [class.active]="statusFilter() === filter"
              (click)="updateFilter(filter, $event)"
              style="text-transform: capitalize"
            >
              {{ filter }}
            </button>
          }
        </div>
      </div>
    </div>

    <app-appointments-table
      [appointments]="filteredAppointments()"
      [isLoading]="isLoading()"
      (action)="handleTableAction($event)"
    ></app-appointments-table>
  </div>
</div>

<app-completion-modal
  [isOpen]="isCompleteModalOpen()"
  [patientName]="selectedAppointmentForCompletion()?.name || ''"
  (closeModal)="closeCompleteModal()"
  (confirm)="onModalConfirm($any($event))"
></app-completion-modal>
