@if (isOpen) {
  <div class="modal-backdrop" (click)="onCancel()" (keydown.escape)="onCancel()" tabindex="-1">
    <div
      class="modal-container"
      (click)="$event.stopPropagation()"
      (keydown.escape)="$event.stopPropagation()"
      tabindex="-1"
    >
      <div class="modal-header">
        <h3>Complete Appointment</h3>
        <button class="close-btn" (click)="onCancel()" (keydown.escape)="onCancel()" tabindex="-1">
          <span class="material-icons">close</span>
        </button>
      </div>

      <div class="modal-body">
        <p class="patient-info">
          Patient: <strong>{{ patientName }}</strong>
        </p>

        <div class="form-group">
          <label for="medical-notes">Medical Notes & Diagnosis</label>
          <textarea
            id="medical-notes"
            [(ngModel)]="notes"
            placeholder="Describe the diagnosis, treatment plan, and observations..."
            rows="5"
          ></textarea>
        </div>

        <div class="attachments-section">
          <label for="documents-actions">Documents & Actions (Coming Soon)</label>
          <div class="action-buttons" id="documents-actions">
            <button
              class="secondary-btn"
              (click)="generatePdf('prescription')"
              title="Generate Prescription"
            >
              <span class="material-icons">description</span> Prescription
            </button>
            <button
              class="secondary-btn"
              (click)="generatePdf('referral')"
              title="Generate Referral"
            >
              <span class="material-icons">assignment_ind</span> Referral
            </button>
            <button class="secondary-btn" title="Attach History">
              <span class="material-icons">history_edu</span> Attach History
            </button>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="cancel-btn" (click)="onCancel()">Cancel</button>
        <button class="confirm-btn" (click)="onConfirm()">
          <span class="material-icons">check</span> Complete Appointment
        </button>
      </div>
    </div>
  </div>
}
