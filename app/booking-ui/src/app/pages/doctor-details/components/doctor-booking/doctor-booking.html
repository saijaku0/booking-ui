<div class="booking-card card sticky">
  <h2>Book Appointment</h2>

  <div class="form-group">
    <label for="booking-date">Select Date</label>
    <input
      id="booking-date"
      type="date"
      [min]="minDate"
      [ngModel]="selectedDate()"
      (ngModelChange)="onDateChange($event)"
      class="date-input"
    />
  </div>

  <h3 class="slots-label">Available Slots</h3>

  @if (isLoadingSlots()) {
    <div class="slots-loader">
      <div class="spinner-small"></div>
      <span>Finding slots...</span>
    </div>
  } @else {
    <div class="slots-grid">
      @for (slot of availableSlots(); track slot.start) {
        <button
          class="slot-btn"
          [class.selected]="selectedSlot() === slot"
          [disabled]="!slot.isAvailable"
          (click)="selectedSlot.set(slot)"
        >
          {{ slot.start | date: 'HH:mm' }}
        </button>
      } @empty {
        <p class="no-slots">No slots available for this date.</p>
      }
    </div>
  }

  <div class="action-area">
    <button
      class="book-btn"
      [disabled]="!selectedSlot() || isBooking()"
      (click)="bookAppointment()"
    >
      {{ isBooking() ? 'Processing...' : 'Confirm Booking' }}
    </button>

    @if (!authService.currentUser()) {
      <p class="login-warning">Login required to confirm</p>
    }
  </div>
</div>
