<header class="header">
  <a routerLink="/" class="logo">
    <h1>BookingUI</h1>
  </a>

  <button class="hamburger-btn" (click)="toggleMobileMenu()">
    <span class="material-icons">{{ isMobileMenu() ? 'close' : 'menu' }}</span>
  </button>

  <nav class="navigation-bar" [class.open]="isMobileMenu()">
    <ul class="nav-links">
      @for (link of navLinks(); track link.path) {
        <li>
          <a [routerLink]="link.path" (click)="closeMobileNav()">{{ link.label }}</a>
        </li>
      }

      <li class="dropdown-container">
        <button
          (click)="toggleMenu()"
          class="nav-link dropdown-trigger"
          [class.active]="menuOpen()"
        >
          Specialties
          <span class="material-icons arrow-icon">{{
            menuOpen() ? 'expand_less' : 'expand_more'
          }}</span>
        </button>
      </li>
    </ul>

    <div class="mobile-actions">
      <ng-container *ngTemplateOutlet="authActions; context: { mode: 'mobile' }"></ng-container>
    </div>
  </nav>

  <div class="desktop-actions">
    <ng-container *ngTemplateOutlet="authActions; context: { mode: 'desktop' }"></ng-container>
  </div>

  @if (menuOpen()) {
    <div class="mega-menu-panel">
      <div class="mobile-menu-header">
        <button class="back-btn" (click)="toggleMenu()">
          <span class="material-icons">arrow_back</span>
        </button>
        <h3>Select Specialty</h3>
        <button class="close-btn" (click)="closeMobileNav()">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="menu-content">
        <h3>All Specialties</h3>
        <div class="specialties-grid">
          @for (spec of specialties(); track spec.id) {
            <a
              [routerLink]="['/search']"
              [queryParams]="{ specialtyId: spec.id }"
              (click)="toggleMenu()"
            >
              {{ spec.name }}
            </a>
          }
        </div>
      </div>
    </div>
    <div
      class="mega-menu-backdrop"
      role="button"
      tabindex="0"
      (click)="toggleMenu()"
      (keydown.enter)="toggleMenu()"
      (keydown.escape)="toggleMenu()"
    ></div>
  }
</header>

@if (isMobileMenu()) {
  <div
    class="overlay"
    role="button"
    tabindex="0"
    (click)="closeMobileNav()"
    (keydown.enter)="closeMobileNav()"
    (keydown.escape)="closeMobileNav()"
  >
    >
  </div>
}
<ng-template #authActions let-mode="mode">
  @if (!currentUser()) {
    <div class="auth-buttons" [class.mobile]="mode === 'mobile'">
      <a routerLink="/auth/login" (click)="closeMobileNav()" class="btn-login">Login</a>
      <a routerLink="/auth/register" (click)="closeMobileNav()" class="btn-signup">Sign Up</a>
    </div>
  } @else {
    <div class="user-panel" [class.mobile-user]="mode === 'mobile'">
      <div class="user-info">
        <a class="avatar" [routerLink]="['/profile']">
          {{ currentUser()?.email?.charAt(0)?.toUpperCase() }}
        </a>
        @if (mode === 'mobile') {
          <div class="details">
            <span class="email">{{ currentUser()?.email }}</span>
            <span class="role">{{ currentUser()?.roles?.[0] }}</span>
          </div>
        }
      </div>

      @if (crmLink()) {
        <a [routerLink]="crmLink()" (click)="closeMobileNav()" class="crm-link">
          <span class="material-icons">dashboard</span>
          <span class="text">Dashboard</span>
        </a>
      }

      <button (click)="logout()" class="logout-btn">
        <span class="material-icons">logout</span>
        @if (mode === 'mobile') {
          <span class="text">Log Out</span>
        }
      </button>
    </div>
  }
</ng-template>
